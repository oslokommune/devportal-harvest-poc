# Distributors

## Technical

### Production

#### Setup
1. `git clone git@github.com:oslokommune/devportal-harvest-poc.git`
2. `kubectl apply -f charts/harvest-output-pvc.yaml` This is the PVC where all
	 the harvesters will pipe their output to and the distributors will fetch data
	 from.
3. Create and configure a [distributors.yaml](https://github.com/oslokommune/devportal-harvest-poc/blob/master/distribute/templates/distributors_template.yaml) file

#### Deploy distribution jobs
1. Ensure the distributors your distributors.yaml require are available as Docker images.
	 See [Deploy distributor docker image](#Deploy harvester Docker image)
2. `cat distributors.yaml | python distribute.py`

#### Deploy distributor Docker image
1. `cd distribute/distributor/<actual distributor>`
2. `make build-image`
3. `make push`

#### Local
1. `cd distribute/distributor/<actual distributor>/`
2. `make .venv`
3. `source .venv/bin/activate`
4. `python <actual harvester>.py`

## Non technical

### What

A distributor is a self contained service which based on an environment will expose the data generated by the harvester(s) somehow

### How

Each distributor runs in a docker container and gets its data from a
PVC. The output must conform to
[this](https://github.com/oslokommune/devportal-harvest-poc/blob/master/docs/standard_json.json) structure.
