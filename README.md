# devportal-harvest-poc

## Setup
1. `git clone git@github.com:oslokommune/devportal-harvest-poc.git`
2. `make init`

## Configure
1. Create a [sources.yaml](https://github.com/oslokommune/devportal-harvest-poc/blob/master/docs/sources_template.yaml) file

## Usage
`cat sources.yaml | python ctl.py`

This command generates a k8s cronjob for each of the specified harvesters per
source.

## Deploy harvesters

1. kubectl apply -f charts/harvest-output-pvc. This is the PVC where all the
	 harvesters will pipe their output and the latest_provider will read from
2. `make build`
3. Create and configure a [sources.yaml](https://github.com/oslokommune/devportal-harvest-poc/blob/master/docs/sources_template.yaml)
4. Run the step in Usage

## Deploy latest_provider

1. `cd tools/latest_provider`
2. `make deploy-test`

## Concepts

### Harvester
A harvester is a self contained service which based on an environment will print
out all the APIs associated with the configured environment.

### Distributor
A distributor is a self contained service which based on an environment will
expose the data generated by the harvester(s) somehow

## Stack
Based on a [sources.yaml](https://github.com/oslokommune/devportal-harvest-poc/blob/master/docs/sources_template.yaml)
file, the ctl.py script will generate cronjobs that will pipe their output 
to a persistent volume.

The latest_provider service will upon a GET request to /apis expose the sum of all the
.json files in the mentionted persistent volume claim.

The harvester frontend does a GET /apis to the latest_provider service and presents
the result.

## [Roadmap](https://github.com/oslokommune/devportal-harvest-poc/projects/1?add_cards_query=is%3Aopen)
